Index: app/src/main/java/com/example/noticeboard/noticeTypes/AddResources.java
IDEA additional info:
Subsystem: com.intellij.openapi.diff.impl.patch.BaseRevisionTextPatchEP
<+>package com.example.noticeboard.noticeTypes;\r\n\r\nimport android.Manifest;\r\nimport android.annotation.SuppressLint;\r\nimport android.app.AlertDialog;\r\nimport android.app.ProgressDialog;\r\nimport android.content.ClipData;\r\nimport android.content.DialogInterface;\r\nimport android.content.Intent;\r\nimport android.content.pm.PackageManager;\r\nimport android.net.Uri;\r\nimport android.os.Build;\r\nimport android.os.Bundle;\r\nimport android.util.Log;\r\nimport android.view.LayoutInflater;\r\nimport android.view.Menu;\r\nimport android.view.MenuItem;\r\nimport android.view.View;\r\nimport android.webkit.URLUtil;\r\nimport android.widget.Button;\r\nimport android.widget.CheckBox;\r\nimport android.widget.TextView;\r\nimport android.widget.Toast;\r\nimport android.widget.Toolbar;\r\n\r\nimport androidx.annotation.NonNull;\r\nimport androidx.annotation.Nullable;\r\nimport androidx.appcompat.app.AppCompatActivity;\r\nimport androidx.core.content.ContextCompat;\r\n\r\nimport com.example.noticeboard.R;\r\nimport com.example.noticeboard.models.resource;\r\nimport com.google.android.gms.tasks.OnCompleteListener;\r\nimport com.google.android.gms.tasks.OnFailureListener;\r\nimport com.google.android.gms.tasks.OnSuccessListener;\r\nimport com.google.android.gms.tasks.Task;\r\nimport com.google.android.material.textfield.TextInputEditText;\r\nimport com.google.android.material.textfield.TextInputLayout;\r\nimport com.google.firebase.auth.FirebaseAuth;\r\nimport com.google.firebase.database.DatabaseReference;\r\nimport com.google.firebase.database.FirebaseDatabase;\r\nimport com.google.firebase.database.annotations.NotNull;\r\nimport com.google.firebase.storage.FirebaseStorage;\r\nimport com.google.firebase.storage.StorageReference;\r\nimport com.google.firebase.storage.UploadTask;\r\n\r\nimport java.util.ArrayList;\r\nimport java.util.HashMap;\r\n\r\nimport es.dmoral.toasty.Toasty;\r\nimport io.ghyeok.stickyswitch.widget.StickySwitch;\r\n\r\npublic class AddResources extends AppCompatActivity {\r\n\r\n    TextView tvResFile, tvResSemDept, tvResSemDeptData;\r\n    TextInputEditText tvResTitle, tvResAuthor, tvResPublication, tvResSubject, tvResDescription, tvResLink;\r\n    TextInputLayout link;\r\n    DatabaseReference reference;\r\n    Toolbar toolbar;\r\n    Button btnResFile;\r\n    AlertDialog.Builder builder;\r\n    StorageReference storageReference;\r\n    String filename = System.currentTimeMillis()+\"\";\r\n    ArrayList<Uri> uriList = new ArrayList<>();\r\n    ArrayList<String> savedList = new ArrayList<>();\r\n    int counter = 0;\r\n    StringBuilder stringBuilder;\r\n\r\n    @SuppressLint(\"CutPasteId\")\r\n    @Override\r\n    protected void onCreate(Bundle savedInstanceState) {\r\n        super.onCreate(savedInstanceState);\r\n        setContentView(R.layout.activity_add_resources);\r\n\r\n        tvResTitle = findViewById(R.id.tvResTitle);\r\n        tvResAuthor = findViewById(R.id.tvResAuthor);\r\n        tvResPublication = findViewById(R.id.tvResPublication);\r\n        tvResSemDept = findViewById(R.id.tvResSemDept);\r\n        tvResSemDeptData = findViewById(R.id.tvResSemDeptData);\r\n        tvResSubject = findViewById(R.id.tvResSubject);\r\n        tvResDescription = findViewById(R.id.tvResDescription);\r\n        tvResLink = findViewById(R.id.tvResLink);\r\n        btnResFile = findViewById(R.id.btnResFile);\r\n        tvResFile = findViewById(R.id.tvResFile);\r\n        link = findViewById(R.id.link);\r\n\r\n        builder = new AlertDialog.Builder(this);\r\n        reference = FirebaseDatabase.getInstance().getReference().child(\"References\");\r\n        storageReference = FirebaseStorage.getInstance().getReference(\"resource\");\r\n\r\n        toolbar = findViewById(R.id.toolbar);\r\n        getSupportActionBar().setTitle(\"Add Resources\");\r\n\r\n        tvResSemDept.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(final View v) {\r\n                final View view = LayoutInflater.from(AddResources.this).inflate(R.layout.dialog_box_resources, null);\r\n                CheckBox cb11, cb12, cb13, cb14, cb15, cb21, cb22, cb23, cb24, cb25, cb31, cb32, cb33, cb34, cb35, cb41, cb42, cb43, cb44, cb45, \r\n                        cb51, cb52, cb53, cb54, cb55, cb61, cb62, cb63, cb64, cb65, cb71, cb72, cb73, cb74, cb75, cb81, cb82, cb83, cb84, cb85;\r\n                cb11 = view.findViewById(R.id.cb11);\r\n                cb12 = view.findViewById(R.id.cb12);\r\n                cb13 = view.findViewById(R.id.cb13);\r\n                cb14 = view.findViewById(R.id.cb14);\r\n                cb15 = view.findViewById(R.id.cb15);\r\n                cb21 = view.findViewById(R.id.cb21);\r\n                cb22 = view.findViewById(R.id.cb22);\r\n                cb23 = view.findViewById(R.id.cb23);\r\n                cb24 = view.findViewById(R.id.cb24);\r\n                cb25 = view.findViewById(R.id.cb25);\r\n                cb31 = view.findViewById(R.id.cb31);\r\n                cb32 = view.findViewById(R.id.cb32);\r\n                cb33 = view.findViewById(R.id.cb33);\r\n                cb34 = view.findViewById(R.id.cb34);\r\n                cb35 = view.findViewById(R.id.cb35);\r\n                cb41 = view.findViewById(R.id.cb41);\r\n                cb42 = view.findViewById(R.id.cb42);\r\n                cb43 = view.findViewById(R.id.cb43);\r\n                cb44 = view.findViewById(R.id.cb44);\r\n                cb45 = view.findViewById(R.id.cb45);\r\n                cb51 = view.findViewById(R.id.cb51);\r\n                cb52 = view.findViewById(R.id.cb52);\r\n                cb53 = view.findViewById(R.id.cb53);\r\n                cb54 = view.findViewById(R.id.cb54);\r\n                cb55 = view.findViewById(R.id.cb55);\r\n                cb61 = view.findViewById(R.id.cb61);\r\n                cb62 = view.findViewById(R.id.cb62);\r\n                cb63 = view.findViewById(R.id.cb63);\r\n                cb64 = view.findViewById(R.id.cb64);\r\n                cb65 = view.findViewById(R.id.cb65);\r\n                cb71 = view.findViewById(R.id.cb71);\r\n                cb72 = view.findViewById(R.id.cb72);\r\n                cb73 = view.findViewById(R.id.cb73);\r\n                cb74 = view.findViewById(R.id.cb74);\r\n                cb75 = view.findViewById(R.id.cb75);\r\n                cb81 = view.findViewById(R.id.cb81);\r\n                cb82 = view.findViewById(R.id.cb82);\r\n                cb83 = view.findViewById(R.id.cb83);\r\n                cb84 = view.findViewById(R.id.cb84);\r\n                cb85 = view.findViewById(R.id.cb85);\r\n\r\n                final CheckBox[] checkBoxes = new CheckBox[] {cb11, cb12, cb13, cb14, cb15, cb21, cb22, cb23, cb24, cb25, cb31, cb32, cb33, cb34, cb35, cb41, cb42, cb43, cb44, cb45,\r\n                        cb51, cb52, cb53, cb54, cb55, cb61, cb62, cb63, cb64, cb65, cb71, cb72, cb73, cb74, cb75, cb81, cb82, cb83, cb84, cb85};\r\n                builder.setView(view);\r\n                builder.setPositiveButton(\"Proceed\", new DialogInterface.OnClickListener() {\r\n                    @Override\r\n                    public void onClick(DialogInterface dialog, int which) {\r\n                        stringBuilder = new StringBuilder();\r\n                        for (CheckBox box : checkBoxes) {\r\n                            if (box.isChecked()) {\r\n                                stringBuilder.append(getSemDept(box.getId(), view)).append(\", \");\r\n                            }\r\n                        }\r\n                        if (stringBuilder.length() == 0) {\r\n                            tvResSemDeptData.setText(\"All combinations of semester and department\");\r\n                            for (CheckBox checkBox : checkBoxes) {\r\n                                stringBuilder.append(getSemDept(checkBox.getId(), view)).append(\", \");\r\n                            }\r\n                        }\r\n                        else tvResSemDeptData.setText(stringBuilder);\r\n                    }\r\n                }).setNegativeButton(\"Cancel\", new DialogInterface.OnClickListener() {\r\n                    @Override\r\n                    public void onClick(DialogInterface dialog, int which) {\r\n                        dialog.dismiss();\r\n                    }\r\n                }).show();\r\n            }\r\n        });\r\n\r\n        StickySwitch stickySwitch = (StickySwitch) findViewById(R.id.stickySwitchRes);\r\n        stickySwitch.setOnSelectedChangeListener(new StickySwitch.OnSelectedChangeListener() {\r\n            @Override\r\n            public void onSelectedChange(@org.jetbrains.annotations.NotNull @NotNull StickySwitch.Direction direction, @org.jetbrains.annotations.NotNull @NotNull String text) {\r\n                if(direction == StickySwitch.Direction.LEFT) {\r\n                    btnResFile.setVisibility(View.VISIBLE);\r\n                    tvResFile.setVisibility(View.VISIBLE);\r\n                    link.setVisibility(View.GONE);\r\n                }\r\n                else {\r\n                    btnResFile.setVisibility(View.GONE);\r\n                    tvResFile.setVisibility(View.GONE);\r\n                    link.setVisibility(View.VISIBLE);\r\n                }\r\n            }\r\n        });\r\n\r\n        btnResFile.setOnClickListener(new View.OnClickListener() {\r\n            @Override\r\n            public void onClick(View v) {\r\n                if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.M) {\r\n                    if (ContextCompat.checkSelfPermission(AddResources.this, Manifest.permission.READ_EXTERNAL_STORAGE) == PackageManager.PERMISSION_GRANTED) {\r\n                        selectFiles();\r\n                    }\r\n                    else requestPermissions(new String[] {Manifest.permission.READ_EXTERNAL_STORAGE}, 1);\r\n                }\r\n                else selectFiles();\r\n            }\r\n        });\r\n    }\r\n\r\n    @Override\r\n    public boolean onCreateOptionsMenu(Menu menu) {\r\n        getMenuInflater().inflate(R.menu.send, menu);\r\n        return true;\r\n    }\r\n\r\n    @Override\r\n    public boolean onOptionsItemSelected(@NonNull MenuItem item) {\r\n        final String title = tvResTitle.getText().toString();\r\n        final String author = tvResAuthor.getText().toString();\r\n        final String publication = tvResPublication.getText().toString();\r\n        final String subject = tvResSubject.getText().toString();\r\n        final String description = tvResDescription.getText().toString();\r\n        final String link = tvResLink.getText().toString();\r\n        final String upload = FirebaseAuth.getInstance().getCurrentUser().getEmail();\r\n        final String semDept = stringBuilder.toString();\r\n\r\n        if (title.isEmpty()) {\r\n            tvResTitle.setError(\"Cannot be empty\");\r\n            tvResTitle.requestFocus();\r\n        }\r\n\r\n        if (subject.isEmpty()) {\r\n            tvResSubject.setError(\"Cannot be empty\");\r\n            tvResSubject.requestFocus();\r\n        }\r\n\r\n        if (!link.isEmpty() && !URLUtil.isValidUrl(link)) {\r\n            tvResLink.setError(\"Please enter a valid Link\");\r\n            tvResLink.requestFocus();\r\n        }\r\n\r\n        else if (item.getItemId() == R.id.itSent) {\r\n            if (!title.isEmpty() && !subject.isEmpty()) {\r\n                resource n = new resource(title, author, publication, subject, description, upload, link, semDept);\r\n                reference.child(filename).setValue(n).addOnSuccessListener(new OnSuccessListener<Void>() {\r\n                    @Override\r\n                    public void onSuccess(Void aVoid) {\r\n                        Toast.makeText(AddResources.this, \"Resource Uploaded\", Toast.LENGTH_SHORT).show();\r\n                    }\r\n                }).addOnFailureListener(new OnFailureListener() {\r\n                    @Override\r\n                    public void onFailure(@NonNull Exception e) {\r\n                        Toast.makeText(AddResources.this, \"Resource Upload Failed\", Toast.LENGTH_SHORT).show();\r\n                    }\r\n                });\r\n\r\n                if (uriList.size() != 0) {\r\n                    final ProgressDialog progressDialog = new ProgressDialog(AddResources.this);\r\n                    progressDialog.setMessage(\"Uploading 0/\"+uriList.size());\r\n                    progressDialog.setCanceledOnTouchOutside(false);\r\n                    progressDialog.setCancelable(false);\r\n                    progressDialog.show();\r\n                    for (int i = 0; i < uriList.size(); i++) {\r\n                        final int finalI = i;\r\n                        FirebaseStorage.getInstance().getReference(filename).child(String.valueOf(i)).putFile(uriList.get(i)).addOnCompleteListener(new OnCompleteListener<UploadTask.TaskSnapshot>() {\r\n                            @Override\r\n                            public void onComplete(@NonNull Task<UploadTask.TaskSnapshot> task) {\r\n                                if (task.isSuccessful()) {\r\n                                    FirebaseStorage.getInstance().getReference(filename).child(String.valueOf(finalI)).getDownloadUrl().addOnCompleteListener(new OnCompleteListener<Uri>() {\r\n                                        @Override\r\n                                        public void onComplete(@NonNull Task<Uri> task) {\r\n                                            counter++;\r\n                                            progressDialog.setMessage(\"Uploaded \"+counter+\"/\"+uriList.size());\r\n                                            if (task.isSuccessful()) {\r\n                                                savedList.add(task.getResult().toString());\r\n                                            }\r\n                                            else {\r\n                                                Toast.makeText(AddResources.this, \"Could Not Save \"+finalI, Toast.LENGTH_SHORT).show();\r\n                                                Log.i(\"Error\", task.getException().toString());\r\n                                            }\r\n                                            if (counter == uriList.size()) {\r\n                                                progressDialog.setMessage(\"Saving Uploaded Files To Database\");\r\n                                                HashMap<String, Object> hashMap = new HashMap<>();\r\n                                                for (int i = 0; i < savedList.size(); i++) {\r\n                                                    hashMap.put(\"File \" + i, savedList.get(i));\r\n                                                }\r\n                                                reference.child(filename).child(\"files\").updateChildren(hashMap)\r\n                                                        .addOnSuccessListener(new OnSuccessListener<Void>() {\r\n                                                            @Override\r\n                                                            public void onSuccess(Void aVoid) {\r\n                                                                progressDialog.dismiss();\r\n                                                                Toast.makeText(AddResources.this, \"Upload Successful\", Toast.LENGTH_SHORT).show();\r\n                                                                finish();\r\n                                                            }\r\n                                                        }).addOnFailureListener(new OnFailureListener() {\r\n                                                    @Override\r\n                                                    public void onFailure(@NonNull Exception e) {\r\n                                                        progressDialog.dismiss();\r\n                                                        Toast.makeText(AddResources.this, \"Could Not Save to database\", Toast.LENGTH_SHORT).show();\r\n                                                    }\r\n                                                });\r\n                                            }\r\n                                        }\r\n                                    });\r\n                                }\r\n                            }\r\n                        }).addOnFailureListener(new OnFailureListener() {\r\n                            @Override\r\n                            public void onFailure(@NonNull Exception e) {\r\n                                //\r\n                            }\r\n                        });\r\n                    }\r\n                }\r\n                else finish();\r\n            }\r\n        }\r\n        return super.onOptionsItemSelected(item);\r\n    }\r\n\r\n    private String getSemDept(int id, View view) {\r\n        String data = view.getResources().getResourceName(id);\r\n        data = data.substring(data.length()-2);\r\n        String sem = \"\", dept = \"\";\r\n        switch (data.charAt(0)) {\r\n            case '1': sem = \"Sem 1\"; break;\r\n            case '2': sem = \"Sem 2\"; break;\r\n            case '3': sem = \"Sem 3\"; break;\r\n            case '4': sem = \"Sem 4\"; break;\r\n            case '5': sem = \"Sem 5\"; break;\r\n            case '6': sem = \"Sem 6\"; break;\r\n            case '7': sem = \"Sem 7\"; break;\r\n            case '8': sem = \"Sem 8\"; break;\r\n        }\r\n\r\n        switch (data.charAt(1)) {\r\n            case '1': dept = \"CS\"; break;\r\n            case '2': dept = \"IT\"; break;\r\n            case '3': dept = \"EXTC\"; break;\r\n            case '4': dept = \"ETRX\"; break;\r\n            case '5': dept = \"AI-DS\"; break;\r\n        }\r\n        return dept+\" \"+sem;\r\n    }\r\n\r\n    private void selectFiles() {\r\n        startActivityForResult(new Intent(Intent.ACTION_GET_CONTENT).setType(\"*/*\").putExtra(Intent.EXTRA_ALLOW_MULTIPLE, true), 2);\r\n    }\r\n\r\n    @Override\r\n    public void onRequestPermissionsResult(int requestCode, @NonNull String[] permissions, @NonNull int[] grantResults) {\r\n        super.onRequestPermissionsResult(requestCode, permissions, grantResults);\r\n        if (requestCode == 1) {\r\n            if (grantResults.length > 0 && grantResults[0] == PackageManager.PERMISSION_GRANTED) {\r\n                selectFiles();\r\n            } else\r\n                Toast.makeText(AddResources.this, \"Permission Denied\", Toast.LENGTH_SHORT).show();\r\n        }\r\n    }\r\n\r\n    @SuppressLint(\"SetTextI18n\")\r\n    @Override\r\n    protected void onActivityResult(int requestCode, int resultCode, @Nullable Intent data) {\r\n        super.onActivityResult(requestCode, resultCode, data);\r\n        if (requestCode == 2) {\r\n            if (resultCode == RESULT_OK && data != null) {\r\n                ClipData clipData = data.getClipData();\r\n                uriList.clear();\r\n                if (clipData != null) {\r\n                    for (int i = 0; i < clipData.getItemCount(); i++) {\r\n                        uriList.add(clipData.getItemAt(i).getUri());\r\n                    }\r\n                    tvResFile.setText(clipData.getItemCount()+\" files selected\");\r\n                    Toasty.success(AddResources.this, clipData.getItemCount()+\" files selected\", Toast.LENGTH_SHORT).show();\r\n                } else  {\r\n                    uriList.add(data.getData());\r\n                    tvResFile.setText(\"1 file selected\");\r\n                    Toasty.success(AddResources.this, \"1 file selected\", Toast.LENGTH_SHORT).show();\r\n                }\r\n            }\r\n        }\r\n    }\r\n}\r\n
Subsystem: com.intellij.openapi.diff.impl.patch.CharsetEP
<+>UTF-8
===================================================================
--- app/src/main/java/com/example/noticeboard/noticeTypes/AddResources.java	(revision 8121b5807538f589208b5c2fd585dd8c0b70f925)
+++ app/src/main/java/com/example/noticeboard/noticeTypes/AddResources.java	(date 1617453287307)
@@ -151,12 +151,11 @@
                             }
                         }
                         if (stringBuilder.length() == 0) {
-                            tvResSemDeptData.setText("All combinations of semester and department");
                             for (CheckBox checkBox : checkBoxes) {
                                 stringBuilder.append(getSemDept(checkBox.getId(), view)).append(", ");
                             }
                         }
-                        else tvResSemDeptData.setText(stringBuilder);
+                        tvResSemDeptData.setText(stringBuilder);
                     }
                 }).setNegativeButton("Cancel", new DialogInterface.OnClickListener() {
                     @Override
@@ -213,7 +212,7 @@
         final String description = tvResDescription.getText().toString();
         final String link = tvResLink.getText().toString();
         final String upload = FirebaseAuth.getInstance().getCurrentUser().getEmail();
-        final String semDept = stringBuilder.toString();
+        final String semDept = tvResSemDeptData.getText().toString();
 
         if (title.isEmpty()) {
             tvResTitle.setError("Cannot be empty");
@@ -230,8 +229,12 @@
             tvResLink.requestFocus();
         }
 
+        if (semDept.equals("Selected Semester and Department")) {
+            Toasty.warning(this, "Select Department and Semester", Toast.LENGTH_SHORT).show();
+        }
+
         else if (item.getItemId() == R.id.itSent) {
-            if (!title.isEmpty() && !subject.isEmpty()) {
+            if (!title.isEmpty() && !subject.isEmpty() && !semDept.isEmpty()) {
                 resource n = new resource(title, author, publication, subject, description, upload, link, semDept);
                 reference.child(filename).setValue(n).addOnSuccessListener(new OnSuccessListener<Void>() {
                     @Override
diff --git .idea/shelf/Uncommitted_changes_before_Update_at_03-04-2021_05_42_PM__Default_Changelist_.xml .idea/shelf/Uncommitted_changes_before_Update_at_03-04-2021_05_42_PM__Default_Changelist_.xml
